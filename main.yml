---
- hosts: all
  gather_facts: false

  vars:
    - snow_username: '{{ lookup("env", "SNOW_USERNAME") }}'
    - snow_password: '{{ lookup("env", "SNOW_PASSWORD") }}'
    - snow_url: '{{ lookup("env", "SNOW_INSTANCE") }}'

  tasks:

  - name: create a ticket in SNOW
    snow_record:
      username: "{{ snow_username }}"
      password: "{{ snow_password }}"
      instance: "{{ snow_url }}"
      state: present
      data:
        short_description: "This is a test opened by Ansible"
        priority: 2
      table: change_request
    register: new_change_request
    